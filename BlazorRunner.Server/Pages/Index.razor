@page "/"
@implements IDisposable

@inject IAssemblyBuilder builder


<div class="flex">
    @for (int i = 0; i < (ImportedTestAssembly?.Length ?? 0); i++)
    {
        <ScriptCard Script=@ImportedTestAssembly[i]></ScriptCard>
    }
</div>

<DirectorCard></DirectorCard>
<ConsoleCard></ConsoleCard>

@code{
    private static IScriptAssembly ImportedTestAssembly = null;

    public static IScriptAssembly SelectedAssembly => ImportedTestAssembly;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        ImportedTestAssembly = builder.Parse(typeof(ServerTestAssembly.MyExampleScript).Assembly);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);

        if (TaskDirector.ExecutingTasks is false)
        {
            await TaskDirector.ExecuteQueuedTasks();
        }
    }

    public void Dispose()
    {
        TaskDirector.Dispose();
    }
}